(()=>{"use strict";var e,t,o,r,n={419:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Library=void 0;var r=o(524),n=o(524),a=function(){function e(){this.books=[],this.users=[]}return e.prototype.addBook=function(e){this.books.push(e)},e.prototype.addUser=function(e){this.users.push(e)},e.prototype.getUsers=function(){return this.users},e.prototype.getBooks=function(){return this.books},e.prototype.find=function(e){return this.users.filter((function(t){return t.id===e}))[0]},e.prototype.findBook=function(e){var t=!0;this.books.forEach((function(o){o.author!==e&&o.bookName!==e||(alert(JSON.stringify(o)),t=!1)})),t&&alert("Книги з таким ім'ям чи автором не знайдено")},e.prototype.saveToLocalStorage=function(){localStorage.clear(),localStorage.setItem("library",JSON.stringify({books:this.books,users:this.users}))},e.prototype.loadFromLocalStorage=function(){var e=localStorage.getItem("library");if(e){var t=JSON.parse(e),o=t.books,a=t.users;this.books=o.map((function(e){return new r.Book(e.bookName,e.author,e.yearOfPublishing)})),this.users=a.map((function(e){return new n.User(e.name,e.email)}))}else console.log("Дані не знайдено в localStorage")},e.prototype.updateBookStatus=function(e,t){var o=this.books.find((function(t){return t.id===e}));o&&(o.isBorrowed=t,this.saveToLocalStorage())},e.prototype.updateUserBorrowedBooks=function(e,t){var o=this.users.find((function(t){return t.id===e})),r=this.books.find((function(e){return e.id===t}));o&&r&&!r.isBorrowed&&(o.borrowedBooks.push(t),r.isBorrowed=!0,this.saveToLocalStorage())},e.prototype.updateView=function(){return{books:this.books,users:this.users}},e.prototype.clear=function(){localStorage.clear()},e}();t.Library=a},524:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.User=t.Book=void 0;var o=function(){function e(e,t,o){this.bookName=e,this.author=t,this.yearOfPublishing=o,this.isBorrowed=!1,this.id=Math.floor(1e9*Math.random())}return e.prototype.borrow=function(){this.isBorrowed=!0},e.prototype.return=function(){this.isBorrowed=!1},e}();t.Book=o;var r=function(){function e(e,t){this.name=e,this.email=t,this.id=Math.floor(1e9*Math.random()),this.borrowedBooks=[]}return e.prototype.getId=function(){return this.id},e.prototype.borrow=function(e){this.borrowedBooks.includes(e)?alert("Цю книгу вже позичено"):this.canBorrow()?this.borrowedBooks.push(e):alert("Неможливо позичити більше трьох книг")},e.prototype.canBorrow=function(){return this.borrowedBooks.length<3},e.prototype.canReturn=function(e){return this.borrowedBooks.includes(e)},e.prototype.return=function(e){this.canReturn(e)?this.borrowedBooks=this.borrowedBooks.filter((function(t){return t!==e})):alert("Книга не знайдена у вашому списку")},e}();t.User=r},154:(e,t,o)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LibraryService=void 0;var r=o(524),n=o(419),a=o(529),i=function(){function e(){}return e.prototype.getUserById=function(t){var o=e.library.find(t);if(o)return o},e.prototype.findBook=function(){var t=prompt("Введіть назву чи автора книги");if(null!=t&&""!==t.trim()){var o=e.library.getBooks().find((function(e){return e.author===t||e.bookName===t}));if(o){var r=o.isBorrowed?"Так":"Ні",n="Знайдено книгу:\n\nНазва: ".concat(o.bookName,"\nАвтор: ").concat(o.author,"\nРік публікації: ").concat(o.yearOfPublishing,"\nПозичено: ").concat(r);alert(n)}else alert("Книги з таким ім'ям чи автором не знайдено")}else alert("Введений рядок порожній")},e.prototype.loadContent=function(){var t=this;e.library.loadFromLocalStorage(),console.log(e.library);var o=e.library.getUsers(),r=e.library.getBooks();o.forEach((function(e){t.createUserElement(e)})),r.forEach((function(e){t.createBookElement(e)}))},e.prototype.addBook=function(){var t=new r.Book(a.Validation.bookName.value,a.Validation.author.value,parseInt(a.Validation.yearOfPublication.value));e.library.addBook(t),this.createBookElement(t),e.library.saveToLocalStorage(),console.log(t instanceof r.Book)},e.prototype.addUser=function(){var t=new r.User(a.Validation.userName.value,a.Validation.email.value);e.library.addUser(t),console.log(t instanceof r.User),this.createUserElement(t),e.library.saveToLocalStorage()},e.prototype.createBookElement=function(t){var o=this;console.log(t);var n=document.createElement("div"),a=document.createElement("label");a.textContent="Назва книги: ".concat(t.bookName,", Автор: ").concat(t.author,", Рік: ").concat(t.yearOfPublishing,")");var i=document.createElement("button");t.isBorrowed?i.textContent="Повернути":i.textContent="Позичити",i.classList.add("btn","btn-secondary"),i.style.float="right",i.id="Borrow",i.addEventListener("click",(function(n){n.preventDefault();var a,l=!0;if("Позичити"==i.textContent)if(null===(a=(a=prompt("введіть ID користувача"))?a.trim():"")||""===a.trim()||isNaN(Number(a)))alert("Введіть коректний ID користувача");else{var c=Number(a);console.log(c);try{(s=o.getUserById(c))instanceof r.User?s?s.canBorrow()?(t.borrow(),s.borrow(t.id),l=!1,alert("Книга ".concat(t.bookName," (").concat(t.yearOfPublishing,"), була позичена ").concat(s.id," ").concat(s.name," ").concat(s.email)),e.library.updateBookStatus(t.id,!0),e.library.updateUserBorrowedBooks(c,t.id),console.log(t),i.textContent="Повернути"):alert("Користувач вже позичив 3 книги"):alert("Не існує користувача з таким ID"):alert("T")}catch(e){alert("Введіть коректні дані"),e instanceof Error?(console.error("Тип помилки:",e.constructor.name),console.error("Повна інформація про помилку:",e),console.error("Повідомлення помилки:",e.message)):console.error("Помилка не є екземпляром Error:",e)}}if("Повернути"==i.textContent&&l)if(null===(a=(a=prompt("введіть ID користувача"))?a.trim():"")||""===a.trim()||isNaN(Number(a)))alert("Введіть коректний ID користувача");else{c=Number(a);try{var s;(s=o.getUserById(c))?s.canReturn(t.id)?(t.return(),s.return(t.id),alert("Книга ".concat(t.bookName," (").concat(t.yearOfPublishing,"), була повернута")),e.library.updateBookStatus(t.id,!1),e.library.updateUserBorrowedBooks(c,t.id),i.textContent="Позичити"):alert("Користувач немає цієї книги"):alert("Не існує користувача з таким ID")}catch(e){alert("Введіть коректні дані")}}}));var l=document.createElement("hr");n.appendChild(a),n.appendChild(i),n.appendChild(l);var c=document.getElementById("bookList");c&&c.appendChild(n)},e.prototype.createUserElement=function(e){var t=document.createElement("div"),o=document.createElement("label");o.textContent="ID: ".concat(e.id,", Ім'я: ").concat(e.name,", Email: ").concat(e.email,")");var r=document.createElement("hr");t.appendChild(o),t.appendChild(r);var n=document.getElementById("userList");n&&n.appendChild(t)},e.prototype.clear=function(){e.library.clear()},e.library=new n.Library,e}();t.LibraryService=i},529:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Validation=void 0;var o=function(){function e(){}return e.prototype.checkBookFields=function(){var t=document.getElementById("bookNameLabel");if(null!=t){if(""===e.bookName.value)return t.style.display="block",!1;t.style.display="none"}var o=document.getElementById("bookAuthorLabel");if(null!=o){if(""===e.author.value)return o.style.display="block",!1;o.style.display="none"}var r=document.getElementById("bookYearLabel");return null==r?(alert("Введіть рік у форматі 4 цифр"),!1):""!==e.yearOfPublication.value?/^\d{4}$/.test(e.yearOfPublication.value)?(r.style.display="none",!0):(alert("Введіть рік у форматі 4 цифр"),!1):(r.style.display="block",!1)},e.prototype.checkUserFields=function(){var t=document.getElementById("userNameLabel");if(null!=t){if(""===e.userName.value)return t.style.display="block",!1;t.style.display="none"}var o=document.getElementById("emailLabel");if(null!=o){if(""===e.email.value)return o.style.display="block",!1;o.style.display="none"}return!0},e.bookName=document.getElementById("bookName"),e.author=document.getElementById("author"),e.yearOfPublication=document.getElementById("yearOfPublication"),e.userName=document.getElementById("userName"),e.email=document.getElementById("email"),e}();t.Validation=o}},a={};function i(e){var t=a[e];if(void 0!==t)return t.exports;var o=a[e]={exports:{}};return n[e](o,o.exports,i),o.exports}e=i(529),t=i(154),o=i(419),r=function(){function r(){this.validation=new e.Validation,this.libraryService=new t.LibraryService,this.library=new o.Library,this.addUserBookHandler(),this.addClearHandler(),this.libraryService.loadContent(),this.addFindHandler()}return r.prototype.addFindHandler=function(){var e=this;document.getElementById("findButton").addEventListener("click",(function(t){t.preventDefault(),e.libraryService.findBook()}))},r.prototype.addUserBookHandler=function(){var e=this;document.getElementById("addBook").addEventListener("click",(function(t){t.preventDefault(),e.validation.checkBookFields()&&e.libraryService.addBook()})),document.getElementById("addUser").addEventListener("click",(function(t){t.preventDefault(),e.validation.checkUserFields()&&e.libraryService.addUser()}))},r.prototype.addClearHandler=function(){var e=this;document.getElementById("clearStorageButton").addEventListener("click",(function(t){t.preventDefault(),confirm("Ви дійсно хочете очистити сховище? Ця дія незворотна.")&&(e.libraryService.clear(),e.updateUI(),alert("Сховище успішно очищено."))}))},r.prototype.updateUI=function(){var e=this.library.updateView(),t=e.books,o=e.users,r=document.getElementById("bookList"),n=document.getElementById("userList");r.innerHTML="",n.innerHTML="",t.forEach((function(e){var t=document.createElement("div");t.textContent="Назва: ".concat(e.bookName,", Автор: ").concat(e.author,", Рік: ").concat(e.yearOfPublishing),r.appendChild(t)})),o.forEach((function(e){var t=document.createElement("div");t.textContent="Ім'я: ".concat(e.name,", Email: ").concat(e.email),n.appendChild(t)}))},r}(),document.addEventListener("DOMContentLoaded",(function(){new r}))})();